Title: Improving blog page load time
Published: 2019/07/11
Tags: 
    - blogging
    - wyam
    - performance
    - load time
---
Page load time matters. Users are impatient and even Google now uses it as metric in their search results ranking. The default Wyam blog themes are a good starting point but what small changes can we make to improve page load times? 

When I created the blog I chose to use the CleanBlog theme ([preview](https://wyam.io/recipes/blog/themes/preview/cleanblog/)). This, along with a few others, is provided out of the box by Wyam. They provide an excellent starting point to hit the ground running and a clean base to begin modifying. 

## Where to start?

Most blogs have the same set of initial priorities, ranging from the overall design to getting some eyes on posts. However, we all have a different order for these priorities. For me the first aspect is page load time, I like making things fast. I find it satisfying to take a hot spot in a critical path and finding ways to improve it. Often an impact can be made by simplifying the existing code, refactoring it to reduce the work done and hopefully making it clearer to read in the process.

A good place to start with the speed of web pages is [PageSpeed Insights by Google](https://developers.google.com/speed/pagespeed/insights/) which analyzes the content and then generates suggestions to make that page faster. As performance is now one of the key metrics Google uses for site ranking in their search results, it's worthwhile having a look to see what gets suggested. The scores can fluctuate by a couple of points between runs but I found that several runs gave an average of 73 for the home page. The key takeaway was the time required for render-blocking resources which looked like this:

| URL                                                                | Size  | Potential Savings |
|--------------------------------------------------------------------|-------|-------------------|
| …css/bootstrap.min.css(wyam.io)                                    | 20 KB | 1,080 ms          |
| …css/highlight.css(wyam.io)                                        | 1 KB  | 480 ms            |
| …css/clean-blog.css(wyam.io)                                       | 2 KB  | 480 ms            |
| …css/master.css(wyam.io)                                           | 1 KB  | 480 ms            |
| …css/font-awesome.min.css(wyam.io)                                 | 7 KB  | 780 ms            |
| /css?family=Lora:400,700,400italic,700italic(fonts.googleapis.com) | 1 KB  | 780 ms            |
| /css?family=…(fonts.googleapis.com)                                | 2 KB  | 780 ms            |
| …css/override.css(wyam.io)                                         | 0 KB  | 480 ms            |
| …js/jquery.min.js(wyam.io)                                         | 30 KB | 1,080 ms          |
| …js/bootstrap.min.js(wyam.io)                                      | 10 KB | 480 ms            |
| …js/highlight.pack.js(wyam.io)                                     | 25 KB | 930 ms            |
| …js/clean-blog.js(wyam.io)                                         | 1 KB  | 180 ms            |
| …js/d3.v3.min.js(wyam.io)                                          | 53 KB | 1,230 ms          |
| …js/trianglify.min.js(wyam.io)                                     | 5 KB  | 330 ms            |
| …js/Please-compressed.js(wyam.io)                                  | 3 KB  | 180 ms            |
| …js/background-check.min.js(wyam.io)                               | 4 KB  | 180 ms            |

That's a lot of resources for a home page with not much happening. Let's break down what's going on with all of this:

* Highlight is for code syntax highlighting
* Bootstrap, clean-blog, master and override are the CSS for the blog in general
* Font Awesome for the RSS icon
* Font files from google fonts used by the theme
* jquery.min.js, bootstrap.min.js, highlight.pack.js, clean-blog.js for general theme functions
* Background-check for switching text colour depending on the colour in the background on the header
* D3, Trianglify and Please-compressed for generating the image in the header

Yup, the image in the header is generated by JavaScript and it's render-blocking. This one's an easy win, we can remove the bottom 4 JavaScript files and replace them with a single webp image which isn't render blocking. Sure it's not quite as cool as generating a triangular mesh that's different per request but it's good enough for my purposes.

Next, I took a look at the font files. We're loading both Lora and Open-Sans in a variety of weights and italics. For my simple blog, I don't need all of these. For now, I removed all external fonts and I'll revisit the fonts I want on my blog in the future when I look at tweaking the design of the blog itself. In a similar vein, I removed the font-awesome file. It was been used for a single icon, the RSS icon. I replaced this with a piece of inline SVG to keep the benefit of using a font without the size of the entire file.

The final step in this process was to look at the CSS been used by the site. First up was Bootstrap, a lot of the CSS included by default wasn't been used so I used their [online bundle builder](https://getbootstrap.com/docs/3.4/customize/) to grab a version of the CSS with only bits I wanted in it. Note that this theme uses Bootstrap 3 and not the newer Bootstrap 4. I took a look at Highlight next. As it was so small I decided to remove the network hit and simple inline it in the page itself. I then did the same with the master.css given how small it was (less than 1KB). Note here that I'm currently minimizing the CSS before adding it inline.

## Result

So after these relatively simple and quick tweaks what do we have to show for it?

Well running the site via PageSpeed Insights again gives us 100 for both mobile and desktop scores. When we look at the impact it's had in the Chrome network tab we can see the following:

|        | Requests | Transferred | Resources | Finish | DOMContentLoaded | Load  |
|--------|----------|-------------|-----------|--------|------------------|-------|
| **Before** | 25       | 342KB       | 756KB     | 1.44s  | 1.06s            | 1.28s |
| **After**  | 9        | 246KB       | 389KB     | 386ms  | 244ms            | 344ms |

Even though the resource size was already reasonably low before we started, by making these changes we've cut our timings by almost 75%. Best of all the impact the changes have had on the design of the site is almost imperceptible (at least if we discount the header image) and the overall site is now simpler. Not too shabby for some relatively small changes. 